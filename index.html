<!DOCTYPE html>
<html>
<head>
	<title>عالم الألوان</title>
        <meta charset="UTF-8">
	<link href="_shared/demo.css" rel="stylesheet" type="text/css">
	<script src="http://code.createjs.com/easeljs-0.8.0.min.js"></script>
	<script>
            
            var stage; 
            var arRight = "صحيح";
            var arWrong = "خطأ";
            var successMsg = [
                "الألوان الأساسية هي الأحمر و الأخضر و الأزرق",
               " نمزج اللون الأحمر مع الأخضر لنحصل على اللون الأصفر",
                "لقد انهيت اللعبة , شكرا لك"
            ];
            var score = 0;
            var listener;
          
            
            function start_game(){
                
                stage = new createjs.Stage("demoCanvas");
                stage1();
                
            }
            
            function createCircle(color,size,x,y,action){
                
                   var circle = new createjs.Shape();
                    circle.graphics.beginFill(color).drawCircle(0, 0, size);
                    circle.x = x;
                    circle.y = y;
                    circle.name = "CR"+color;
                    
                    circle.on("click", function() {destroyCircle("CR"+color,action);});
                    //circle.addEventListener("click", function(event) { alert("clicked"); })    
                    return circle;
                
            }
            
            function createMoveableCircle(color,size){
                
                   var circle = new createjs.Shape();
                   circle.graphics.beginFill(color).drawCircle(0, 0, size);
                   circle.name = "CR"+color;
                   return circle;
                
            }
            
            function destroyCircle(index,action){
               
               stage.removeChild(stage.getChildByName("stat"));
               var x = stage.getChildByName(index).x - 5;
               var y = stage.getChildByName(index).y - 5;
               
               if(action == "right"){
                   
                stage.removeChild(stage.getChildByName(index));
                
                //stage.addChild(createText(arRight,x,y,"blue","stat"));
                
                score++;
                
               }else{
                   
                  stage.addChild(createText(arWrong,x,y,"red","stat"));  
               }
               
               if(score < 3){
                 
                      stage.update();
               }else{
                   
  
                   //stage2();
                   
                   showSuccess(successMsg[0],"stage2(); hideWind();","إلى المرحلة الثانية");
               }
               
             
                
            }
            
            
          function init(){
               
                 stage.clear();
                 stage.removeAllChildren();
                 stage.removeAllEventListeners(); 
                 score = 0; 
           }
           
           
            function resetGame(){
                
                 init();
                 stage1();
            }
            
            function createText(txt,x,y,color,stat){
               
                    var text = new createjs.Text(txt, "bold 15px Arial", color);
                    text.x = x;
                    text.y = y;
                    text.name = stat;
                    
                    return text;
            }
            

           function getRandomInt(min, max) {
               
            return Math.floor(Math.random() * (max - min)) + min;
            
         }


         function createMovable(circle,x,y){
             
             
             var dragger = new createjs.Container();
	     dragger.x = x;
             dragger.y = y;
	     dragger.addChild(circle);
	     stage.addChild(dragger);
			
	     dragger.on("pressmove",function(evt) {
                 
		// currentTarget will be the container that the event listener was added to:
		evt.currentTarget.x = evt.stageX;
		evt.currentTarget.y = evt.stageY;
		// make sure to redraw the stage to show the change:
		stage.update();
                                
		});
             
             
         }
           
   
           
           
           function addImage(loc,posX,posY,scr){
               
                 var image = new createjs.Bitmap(loc);
                 image.x = posX;
                 image.y = posY; 
                 
                 image.on("click", function() { checkImage(scr,posX,posY);});
                 stage.addChild(image);
               
           }
           
           
           function checkImage(scr,x,y){
               
               stage.removeChild(stage.getChildByName("stat"));
               //alert("Got "+scr+" "+x+" "+y);
               
               if(scr == 1){
                   
                   showSuccess(successMsg[2],"init(); stage1(); hideWind();","إالى المرحلة الأولى");
                   
               }else{
                   
                  stage.addChild(createText(arWrong,x+55,y+50,"red","stat")); 
                   
               }
               
               stage.update();
           }
         
           function hideWind(){
               
                document.getElementById("successWind").style.display = "none";
           
           
           }
           
           
           function stage1() {
                     
                       createjs.Touch.enable(stage);
                       var stageDisc = ["المرحلة الأولى : اختر الألوان الاساسية"];
                       var colors = ["red","black","green","blue","pink","yellow"];
                       var action;
                       
                        //Stage 1 pick primary color
                        //
                    
                        //stage.addChild(createText(stageDisc[0],300,10,"black"));
                        document.getElementById("levelName").innerHTML = stageDisc[0];
                        
                        for(var i = 0 ; i < colors.length ; i++){
                         
                         action = (colors[i] == "red" ||  colors[i] == "green" || colors[i] == "blue") ? "right":"wrong";
                         stage.addChildAt(createCircle(colors[i],30,getRandomInt(20,780),getRandomInt(20,350),action));
                        }
                        
                    stage.update();    
		}
                
       
            function stage2(){
                
                //stage = new createjs.Stage("demoCanvas");
                
                init();
                   
                var stageDisc = "المرحلة الثانية:إمزج الألوان لتحصل على اللون الأصفر";
                document.getElementById("levelName").innerHTML = stageDisc;
                stage.mouseMoveOutside = true;
                
                createMovable(createMoveableCircle("red",30),50,50);
                createMovable(createMoveableCircle("blue",30),150,50);
                createMovable(createMoveableCircle("green",30),250,50);
                
               listener = createjs.Ticker.on("tick", tick);
                
            }
            
            
            function stage3(){
                 
                 init();
                 
                 var stageDisc = "المرحلة الثالثة: اختر الصورة اللتي تحتوي على اللون الأحمر";
                 document.getElementById("levelName").innerHTML = stageDisc;
            
                 addImage("https://cloud.githubusercontent.com/assets/11932296/7210714/ece15bd0-e55c-11e4-80e2-5dd24a8a7b00.jpg",50,50,1);
                 addImage("https://cloud.githubusercontent.com/assets/11932296/7210721/fa0f2364-e55c-11e4-9220-edc0b9793e0b.jpg",270,50,0);
                 addImage("https://cloud.githubusercontent.com/assets/11932296/7210726/023d95a2-e55d-11e4-8a49-38b261da0373.jpg",490,50,0);
                
                 stage.update();                
            }
      	
             function addHexColor(c1, c2) {
                 
                 var hexStr = (parseInt(c1, 16) + parseInt(c2, 16)).toString(16);
                 while (hexStr.length < 6) { hexStr = '0' + hexStr; } // Zero pad.
                 return hexStr;
             }
             
             
             function tick(event) {
                 
                 var redBall    = stage.getChildAt(0);
                 var blueBall   = stage.getChildAt(1);
                 var greenBall   = stage.getChildAt(2);
                 var blueBallCr = "0000ff";
                 var redBallCr  = "ff0000";
                 var greenBallCr = "00ff00";
                
                 //alert(resultColor);
                 
                 //var greenBall = stage.getChildByName("CRgreen");
                 //blueBall.alpha = 0.5;
                 
		var pt1 = redBall.localToLocal(0,0,blueBall);
                var pt2 = redBall.localToLocal(0,0,greenBall);
                var pt3 = blueBall.localToLocal(0,0,greenBall);
                
		if (blueBall.hitTest(pt1.x, pt1.y))  { stage.removeChildAt(3); stage.addChildAt(createCircle("#"+addHexColor(blueBallCr,redBallCr),30,150,150),3); }
                if (greenBall.hitTest(pt2.x, pt2.y)) { 
                    
                   
                    stage.removeChildAt(3); 
                    stage.addChildAt(createCircle("#"+addHexColor(greenBallCr,redBallCr),30,150,150),3);
                    showSuccess(successMsg[1],"stage3(); hideWind();","إلى المرحلة الثالثة");
                    createjs.Ticker.off("tick", listener);
                   
                    
                }
                if (greenBall.hitTest(pt3.x, pt3.y)) { stage.removeChildAt(3); stage.addChildAt(createCircle("#"+addHexColor(blueBallCr,greenBallCr),30,150,150),3); }
			
			stage.update(event);
		}
                
                
                function showSuccess(message,stage,stageBtnTxt){
                  
                    document.getElementById("msg").innerHTML = message;
                    document.getElementById("stageBtn").innerHTML = "<button type=\"button\" onClick=\""+stage+"\">"+stageBtnTxt+"</button>";
                    document.getElementById("successWind").style.display = "block";
                }
                
	</script>
        
        <style>
            
            body{
                
                width:100%;
                margin:0px;
                padding:0px;
                font-family: arial;    
            }
            
            #demoCanvas{
                
              
                border: black solid 1px;
                background-image: url("https://cloud.githubusercontent.com/assets/11932296/7210702/d32df05e-e55c-11e4-9af6-4892cfb5d85a.jpg");
                background-size: 800px 400px;
                
            }
            
            #levelName{
               
                height: 20px;
                width:100%;
                text-align: center;
                font-weight: bold;
                margin-bottom: 10px
                
            }
            
            #mainbar{
                
                width:100%;
                height:50px;
               
                background-color: black;
                color:white;
                font-weight: bold;
                font-size: 25px;
                text-align: center;
          
            }
            
            #lsidebar{
                float: left;
                width:10%;
                height: 500px;  
                
     
            }
            
            #playground{
               /* float: left;
               */
                margin-left: auto;
                margin-right: auto;
                width:800px;
                height: 500px;
                padding-top: 15px;
                z-index: 0;
                
                
            }
            
            #rsidebar{
                
                float: left;
                width:10%;
                height: 500px;     
            }
            
            #successWind{
                
                background-color: white;
                width: 300px;
                height: 200px;
                top:20%;
                left:40%;
                position: absolute;
                z-index: 10;
                display: none;
                border:black solid medium;
                text-align: right;
                direction: rtl;
                padding: 0px;
                margin: 0px;
            }
            
            #successWindTitle{
                
              background-color: black;
              color:white;
              font-weight: bold;
              font-size: 20px;
              text-align: center;  
              
            }
            
            #msg{
                
                padding: 10px;
                font-size: 15px;
                
            }
        </style>
</head>
<body onload="start_game();">
    
   
   
    <div id="mainbar">
   
      عالم الألوان
    النسخة التجريبية
    
    </div>
    <!--<div id="lsidebar"></div>-->
    
          <div id="successWind">
              <div id="successWindTitle">أحسنت</div>
             <p id="msg"></p>
             <span id="stageBtn"></span>
             <button type="button" onClick="resetGame(); hideWind();">البدء من جديد</button>
         </div>
    
    <div id="playground">
         <div id="levelName"></div>
         
   
         
	<canvas id="demoCanvas" width="800" height="400">
		alternate content
	</canvas><br>
        
        <button type="button" onClick="resetGame(); hideWind();">البدء من جديد</button>
   </div>
   <!-- <div id="rsidebar"></div> -->
</body>
</html>
